<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMA Pro Scanner | Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-bg: #0a0b1e;
            --accent-blue: #00d2ff;
            --accent-purple: #9d50bb;
            --accent-pink: #ff2e97;
            --accent-orange: #ff6b35;
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --success: #00ff88;
            --danger: #ff4d4d;
            --warning: #ffaa00;
            --font-outfit: 'Outfit', sans-serif;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            background: linear-gradient(135deg, #0a0b1e 0%, #1a1b3e 50%, #0a0b1e 100%);
            background-size: 200% 200%;
            animation: gradientShift 15s ease infinite;
            color: var(--text-primary);
            font-family: var(--font-outfit);
            overflow-x: hidden;
            min-height: 100vh;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .background {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: -1; overflow: hidden;
        }

        .blur-circle {
            position: absolute; border-radius: 50%;
            filter: blur(120px); opacity: 0.3;
            animation: float 20s ease-in-out infinite;
        }

        .circle-1 {
            width: 500px; height: 500px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            top: -100px; right: -100px;
            animation: float 15s ease-in-out infinite, rotate 30s linear infinite;
        }

        .circle-2 {
            width: 400px; height: 400px;
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-pink));
            bottom: -50px; left: -50px;
            animation: float 20s ease-in-out infinite reverse, rotate 40s linear infinite reverse;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(30px, -30px) scale(1.1); }
            66% { transform: translate(-30px, 30px) scale(0.9); }
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Sidebar */
        .sidebar {
            position: fixed; left: 0; top: 0;
            width: 250px; height: 100vh;
            padding: 30px 20px; z-index: 1000;
            display: flex; flex-direction: column; gap: 30px;
        }

        .sidebar-header {
            display: flex; align-items: center; gap: 12px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--glass-border);
        }

        .sidebar-header h3 {
            font-size: 1.3rem; font-weight: 700;
            color: var(--text-primary);
        }

        .pulse-dot {
            width: 12px; height: 12px;
            background: var(--success);
            border-radius: 50%; position: relative;
        }

        .pulse-dot::after {
            content: ''; position: absolute;
            width: 100%; height: 100%;
            background: inherit; border-radius: 50%;
            animation: pulse-ring 2s infinite;
        }

        @keyframes pulse-ring {
            0% { transform: scale(1); opacity: 0.5; }
            100% { transform: scale(3); opacity: 0; }
        }

        .sidebar-nav {
            display: flex; flex-direction: column; gap: 10px;
        }

        .nav-item {
            display: flex; align-items: center; gap: 15px;
            padding: 15px 20px; border-radius: 12px;
            color: var(--text-secondary); text-decoration: none;
            transition: all 0.3s ease; cursor: pointer;
        }

        .nav-item i { font-size: 1.2rem; width: 24px; }
        .nav-item span { font-weight: 500; font-size: 0.95rem; }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
        }

        .nav-item.active {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            color: white;
        }

        /* Glass */
        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
            position: relative; overflow: hidden;
        }

        .glass::before {
            content: ''; position: absolute;
            top: 0; left: -100%;
            width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }

        .glass:hover::before { left: 100%; }

        .glass:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 60px rgba(0, 210, 255, 0.3);
            border-color: rgba(0, 210, 255, 0.5);
        }

        /* Main */
        .dashboard-container {
            margin-left: 270px; padding: 40px 30px;
            max-width: 1200px;
        }

        header {
            display: flex; justify-content: space-between;
            align-items: center; margin-bottom: 40px;
        }

        .logo h1 {
            font-size: 2rem; font-weight: 700; letter-spacing: -0.5px;
        }

        .status-badge {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            padding: 8px 16px; border-radius: 100px;
            font-size: 0.85rem;
            display: flex; align-items: center; gap: 8px;
        }

        .status-badge .dot {
            width: 8px; height: 8px;
            background: var(--success); border-radius: 50%;
        }

        /* Card */
        .card {
            padding: 30px;
            animation: fadeInUp 0.6s ease-out;
            margin-bottom: 30px;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card h2 {
            margin-bottom: 25px; font-size: 1.2rem;
            color: var(--text-primary); font-weight: 600;
            display: flex; align-items: center; gap: 10px;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px; margin-bottom: 30px;
        }

        .stat-card {
            display: flex; align-items: center; gap: 20px;
            padding: 25px; cursor: default;
            animation: fadeInUp 0.6s ease-out;
        }

        .stat-card:nth-child(1) { animation-delay: 0.1s; }
        .stat-card:nth-child(2) { animation-delay: 0.2s; }
        .stat-card:nth-child(3) { animation-delay: 0.3s; }
        .stat-card:nth-child(4) { animation-delay: 0.4s; }
        .stat-card:nth-child(5) { animation-delay: 0.5s; }

        .stat-icon {
            width: 60px; height: 60px; border-radius: 15px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; color: white;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            animation: pulse-glow 2s ease-in-out infinite;
            flex-shrink: 0;
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3); transform: scale(1); }
            50% { box-shadow: 0 10px 35px rgba(0, 210, 255, 0.5); transform: scale(1.05); }
        }

        .stat-content h3 {
            font-size: 2rem; font-weight: 700; margin: 0;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-content p {
            margin: 5px 0 0; color: var(--text-secondary); font-size: 0.9rem;
        }

        /* Upload Section */
        .upload-area {
            border: 2px dashed var(--glass-border);
            border-radius: 20px; padding: 50px;
            text-align: center; cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 30px;
        }

        .upload-area:hover {
            border-color: var(--accent-blue);
            background: rgba(0, 210, 255, 0.05);
            transform: translateY(-3px);
        }

        .upload-area.drag-over {
            border-color: var(--accent-purple);
            background: rgba(157, 80, 187, 0.1);
        }

        .upload-area .upload-icon {
            font-size: 3rem; margin-bottom: 15px;
            color: var(--accent-blue);
        }

        .upload-area p { font-size: 1.1rem; color: var(--text-secondary); }
        .upload-area .hint { font-size: 0.85rem; color: #666; margin-top: 8px; }

        #fileInput { display: none; }

        /* Filters */
        .filters-section {
            display: flex; gap: 15px; margin-bottom: 20px;
            align-items: center; flex-wrap: wrap;
        }

        .search-box {
            position: relative; flex: 1; min-width: 200px;
        }

        .search-box i {
            position: absolute; left: 15px; top: 50%;
            transform: translateY(-50%);
            color: var(--accent-blue); pointer-events: none;
        }

        .search-box input {
            width: 100%;
            padding: 12px 15px 12px 45px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 12px; color: white;
            font-family: inherit; font-size: 0.95rem; outline: none;
            transition: all 0.3s ease;
        }

        .search-box input:focus {
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(0, 210, 255, 0.1);
        }

        .filter-group { display: flex; gap: 10px; }

        .filter-select {
            padding: 12px 40px 12px 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 12px; color: white;
            font-family: inherit; font-size: 0.9rem;
            outline: none; cursor: pointer;
            transition: all 0.3s ease;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%2300d2ff' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
        }

        .filter-select:hover {
            background-color: rgba(255, 255, 255, 0.08);
            border-color: var(--accent-blue);
        }

        .filter-select option { background: var(--primary-bg); color: white; }

        /* Card Header */
        .card-header {
            display: flex; justify-content: space-between;
            align-items: center; margin-bottom: 20px;
        }

        .header-actions { display: flex; gap: 10px; }

        .icon-btn {
            padding: 10px 18px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 10px; color: white;
            font-size: 0.9rem; font-family: inherit;
            display: flex; align-items: center; gap: 8px;
            cursor: pointer; transition: all 0.3s ease;
        }

        .icon-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--accent-blue);
            transform: translateY(-2px);
        }

        .success-btn { border-color: var(--success); }
        .success-btn:hover { background: rgba(0, 255, 136, 0.1); border-color: var(--success); }

        /* Table */
        .table-container { overflow-x: auto; }

        table { width: 100%; border-collapse: collapse; text-align: left; }

        th {
            padding: 15px; color: var(--text-secondary);
            font-weight: 500; font-size: 0.9rem;
            border-bottom: 1px solid var(--glass-border);
        }

        td {
            padding: 18px 15px; font-size: 0.9rem;
            border-bottom: 1px solid var(--glass-border);
        }

        tbody tr { transition: background 0.2s; }
        tbody tr:hover { background: rgba(255, 255, 255, 0.03); }

        .signal-long { color: var(--success); font-weight: 700; }
        .signal-short { color: var(--danger); font-weight: 700; }

        .daily-change-positive { color: var(--success); font-weight: 700; }
        .daily-change-negative { color: var(--danger); font-weight: 700; }

        .badge-tf {
            background: rgba(0, 210, 255, 0.1); color: var(--accent-blue);
            padding: 2px 8px; border-radius: 4px;
            font-weight: 600; font-size: 0.8rem;
        }

        .badge-exchange {
            background: rgba(255, 102, 0, 0.1); color: var(--accent-orange);
            padding: 2px 8px; border-radius: 4px;
            font-weight: 600; font-size: 0.8rem;
            text-transform: uppercase;
        }

        .badge-regime {
            background: rgba(157, 80, 187, 0.15); color: #c084fc;
            padding: 2px 8px; border-radius: 4px;
            font-weight: 600; font-size: 0.8rem;
        }

        /* Confidence bar */
        .confidence-cell { min-width: 100px; }

        .confidence-bar-wrap {
            display: flex; align-items: center; gap: 8px;
        }

        .confidence-bar {
            flex: 1; height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px; overflow: hidden;
        }

        .confidence-fill {
            height: 100%; border-radius: 4px;
            transition: width 0.5s ease;
        }

        .conf-high { background: linear-gradient(90deg, #00ff88, #4ade80); }
        .conf-mid { background: linear-gradient(90deg, #eab308, #facc15); }
        .conf-low { background: linear-gradient(90deg, #ef4444, #f87171); }

        .confidence-text { font-size: 0.8rem; font-weight: 600; min-width: 36px; }

        /* Sortable */
        .sortable { cursor: pointer; user-select: none; transition: all 0.2s ease; }
        .sortable:hover { color: var(--accent-blue); }

        .sort-icon {
            font-size: 0.7rem; margin-left: 5px;
            opacity: 0.5; transition: all 0.2s ease;
        }

        .sort-icon.active { opacity: 1; color: var(--accent-blue); }

        .results-count {
            margin-top: 15px; padding: 10px; text-align: center;
            color: var(--text-secondary); font-size: 0.9rem;
            border-top: 1px solid var(--glass-border);
        }

        /* TradingView Button */
        .tradingview-btn {
            background: linear-gradient(135deg, #2962ff, #1e53e5);
            padding: 8px 16px; border-radius: 8px;
            font-size: 0.85rem; color: white; border: none;
            display: flex; align-items: center; gap: 6px;
            cursor: pointer; transition: all 0.3s ease;
            font-family: inherit; font-weight: 600;
        }

        .tradingview-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(41, 98, 255, 0.4);
        }

        /* Config Section */
        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .config-item {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px; border-radius: 12px;
            border: 1px solid var(--glass-border);
        }

        .config-item .label {
            font-size: 0.8rem; color: var(--text-secondary);
            text-transform: uppercase; letter-spacing: 0.5px;
            margin-bottom: 6px;
        }

        .config-item .value {
            font-size: 1.1rem; font-weight: 600; color: var(--text-primary);
        }

        .config-item .value.enabled { color: var(--success); }
        .config-item .value.disabled { color: var(--text-secondary); }

        /* Cache Section */
        .cache-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .cache-meter-item { margin-bottom: 18px; }

        .meter-label {
            display: flex; justify-content: space-between;
            font-size: 0.85rem; margin-bottom: 6px;
        }

        .meter-label .key { color: var(--text-secondary); }
        .meter-label .val { color: var(--text-primary); font-weight: 600; }

        .meter-bar {
            width: 100%; height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px; overflow: hidden;
        }

        .meter-fill {
            height: 100%; border-radius: 6px;
            background: linear-gradient(90deg, var(--accent-purple), var(--accent-blue));
            transition: width 1s ease;
        }

        /* Toast */
        #toast-container {
            position: fixed; top: 20px; right: 20px;
            z-index: 10000;
            display: flex; flex-direction: column; gap: 10px;
        }

        .toast {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 12px; padding: 15px 20px;
            min-width: 300px;
            display: flex; align-items: center; gap: 12px;
            opacity: 0; transform: translateX(400px);
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .toast.show { opacity: 1; transform: translateX(0); }
        .toast i { font-size: 1.2rem; }

        .toast-success { border-left: 4px solid var(--success); }
        .toast-success i { color: var(--success); }
        .toast-error { border-left: 4px solid var(--danger); }
        .toast-error i { color: var(--danger); }
        .toast-info { border-left: 4px solid var(--accent-blue); }
        .toast-info i { color: var(--accent-blue); }
        .toast-warning { border-left: 4px solid var(--warning); }
        .toast-warning i { color: var(--warning); }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--glass-border); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--text-secondary); }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar { width: 80px; padding: 30px 10px; }
            .sidebar-header h3, .nav-item span { display: none; }
            .nav-item { justify-content: center; padding: 15px; }
            .dashboard-container { margin-left: 100px; }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%; height: auto; position: relative;
                flex-direction: row; padding: 15px;
            }
            .sidebar-nav { flex-direction: row; flex: 1; justify-content: space-around; }
            .nav-item span { display: none; }
            .dashboard-container { margin-left: 0; padding: 20px 15px; }
            .filters-section { flex-direction: column; }
            .header-actions { flex-direction: column; gap: 8px; }
            .stats-grid { grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); }
            .cache-stats { grid-template-columns: 1fr; }
        }
    </style>
</head>

<body>
    <div class="background">
        <div class="blur-circle circle-1"></div>
        <div class="blur-circle circle-2"></div>
    </div>

    <!-- Sidebar Navigation -->
    <nav class="sidebar glass">
        <div class="sidebar-header">
            <span class="pulse-dot"></span>
            <h3>AMA Pro</h3>
        </div>
        <div class="sidebar-nav">
            <a href="#" class="nav-item active" data-section="signals-section">
                <i class="fas fa-chart-line"></i>
                <span>Signals</span>
            </a>
            <a href="#" class="nav-item" data-section="config-section">
                <i class="fas fa-sliders-h"></i>
                <span>Configuration</span>
            </a>
            <a href="#" class="nav-item" data-section="cache-section">
                <i class="fas fa-database"></i>
                <span>Cache & ML</span>
            </a>
        </div>
    </nav>

    <main class="dashboard-container">
        <header>
            <div class="logo">
                <h1>AMA Pro Scanner Dashboard</h1>
            </div>
            <div class="status-badge" id="app-status">
                <span class="dot"></span> <span id="status-text">Ready</span>
            </div>
        </header>

        <!-- Upload Section -->
        <section id="upload-section">
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon"><i class="fas fa-cloud-upload-alt"></i></div>
                <p>Drop your scan results CSV here or click to upload</p>
                <div class="hint">Accepts ama_pro_scan_results_*.csv files</div>
                <input type="file" id="fileInput" accept=".csv">
            </div>
        </section>

        <!-- Stats Dashboard -->
        <section class="stats-grid" id="stats-section" style="display:none;">
            <div class="stat-card glass">
                <div class="stat-icon" style="background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="stat-content">
                    <h3 id="total-signals">0</h3>
                    <p>Total Signals</p>
                </div>
            </div>
            <div class="stat-card glass">
                <div class="stat-icon" style="background: linear-gradient(135deg, var(--success), #00cc6a);">
                    <i class="fas fa-arrow-up"></i>
                </div>
                <div class="stat-content">
                    <h3 id="long-signals">0</h3>
                    <p>Long Signals</p>
                </div>
            </div>
            <div class="stat-card glass">
                <div class="stat-icon" style="background: linear-gradient(135deg, var(--danger), #cc0044);">
                    <i class="fas fa-arrow-down"></i>
                </div>
                <div class="stat-content">
                    <h3 id="short-signals">0</h3>
                    <p>Short Signals</p>
                </div>
            </div>
            <div class="stat-card glass">
                <div class="stat-icon" style="background: linear-gradient(135deg, var(--accent-orange), var(--accent-pink));">
                    <i class="fas fa-brain"></i>
                </div>
                <div class="stat-content">
                    <h3 id="avg-confidence">0%</h3>
                    <p>Avg Confidence</p>
                </div>
            </div>
            <div class="stat-card glass">
                <div class="stat-icon" style="background: linear-gradient(135deg, #6366f1, #8b5cf6);">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="stat-content">
                    <h3 id="last-scan">--</h3>
                    <p>Last Scan</p>
                </div>
            </div>
        </section>

        <!-- Signals Results Section -->
        <section id="signals-section" class="card glass" style="display:none;">
            <div class="card-header">
                <h2><i class="fas fa-signal"></i> Detected Signals</h2>
                <div class="header-actions">
                    <button id="load-another" class="icon-btn">
                        <i class="fas fa-folder-open"></i> Load CSV
                    </button>
                    <button id="export-csv" class="icon-btn success-btn">
                        <i class="fas fa-download"></i> Export CSV
                    </button>
                </div>
            </div>

            <!-- Filters and Search -->
            <div class="filters-section">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="search-input" placeholder="Search by symbol...">
                </div>
                <div class="filter-group">
                    <select id="signal-filter" class="filter-select">
                        <option value="all">All Signals</option>
                        <option value="LONG">LONG Only</option>
                        <option value="SHORT">SHORT Only</option>
                    </select>
                    <select id="timeframe-filter" class="filter-select">
                        <option value="all">All Timeframes</option>
                    </select>
                    <select id="regime-filter" class="filter-select">
                        <option value="all">All Regimes</option>
                    </select>
                </div>
            </div>

            <div class="table-container">
                <table id="results-table">
                    <thead>
                        <tr>
                            <th class="sortable" data-sort="symbol">
                                Symbol <i class="fas fa-sort sort-icon"></i>
                            </th>
                            <th class="sortable" data-sort="exchange">
                                Exchange <i class="fas fa-sort sort-icon"></i>
                            </th>
                            <th class="sortable" data-sort="timeframe">
                                Timeframe <i class="fas fa-sort sort-icon"></i>
                            </th>
                            <th class="sortable" data-sort="signal">
                                Signal <i class="fas fa-sort sort-icon"></i>
                            </th>
                            <th class="sortable" data-sort="angle">
                                Angle <i class="fas fa-sort sort-icon"></i>
                            </th>
                            <th class="sortable" data-sort="price">
                                Price <i class="fas fa-sort sort-icon"></i>
                            </th>
                            <th class="sortable" data-sort="change">
                                Daily Change <i class="fas fa-sort sort-icon"></i>
                            </th>
                            <th class="sortable" data-sort="confidence">
                                Confidence <i class="fas fa-sort sort-icon"></i>
                            </th>
                            <th>Regime</th>
                            <th class="sortable" data-sort="timestamp">
                                Timestamp <i class="fas fa-sort sort-icon"></i>
                            </th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td colspan="11" style="text-align:center; padding: 40px; color: var(--text-secondary);">No signals loaded yet.</td></tr>
                    </tbody>
                </table>
            </div>
            <div class="results-count" id="results-count"></div>
        </section>

        <!-- Configuration Section -->
        <section id="config-section" class="card glass" style="display:none;">
            <h2><i class="fas fa-sliders-h"></i> Scanner Configuration</h2>
            <div class="config-grid" id="config-grid">
                <div class="config-item">
                    <div class="label">Exchange</div>
                    <div class="value" id="cfg-exchange">Binance</div>
                </div>
                <div class="config-item">
                    <div class="label">Type</div>
                    <div class="value">Futures</div>
                </div>
                <div class="config-item">
                    <div class="label">Max Symbols</div>
                    <div class="value" id="cfg-symbols">500</div>
                </div>
                <div class="config-item">
                    <div class="label">Concurrency</div>
                    <div class="value">50</div>
                </div>
                <div class="config-item">
                    <div class="label">Rate Limit</div>
                    <div class="value">1200/min</div>
                </div>
                <div class="config-item">
                    <div class="label">Cache TTL</div>
                    <div class="value">30s</div>
                </div>
                <div class="config-item">
                    <div class="label">ML Engine</div>
                    <div class="value enabled"><i class="fas fa-check-circle"></i> Enabled</div>
                </div>
                <div class="config-item">
                    <div class="label">WebSocket</div>
                    <div class="value disabled"><i class="fas fa-times-circle"></i> Disabled</div>
                </div>
                <div class="config-item">
                    <div class="label">Redis</div>
                    <div class="value disabled"><i class="fas fa-times-circle"></i> Disabled</div>
                </div>
                <div class="config-item">
                    <div class="label">Timeframes</div>
                    <div class="value" id="cfg-timeframes">15m, 30m, 1h, 2h, 4h, 1d</div>
                </div>
            </div>
        </section>

        <!-- Cache & ML Section -->
        <section id="cache-section" class="card glass" style="display:none;">
            <h2><i class="fas fa-database"></i> Cache & ML Performance</h2>
            <div class="cache-stats">
                <div>
                    <div class="cache-meter-item">
                        <div class="meter-label">
                            <span class="key">Memory Cache Entries</span>
                            <span class="val" id="cache-entries">3,001</span>
                        </div>
                        <div class="meter-bar">
                            <div class="meter-fill" id="cache-meter" style="width: 85%;"></div>
                        </div>
                    </div>
                    <div class="cache-meter-item">
                        <div class="meter-label">
                            <span class="key">Memory Hit Rate</span>
                            <span class="val" id="hit-rate">0%</span>
                        </div>
                        <div class="meter-bar">
                            <div class="meter-fill" id="hit-meter" style="width: 0%;"></div>
                        </div>
                    </div>
                    <div class="cache-meter-item">
                        <div class="meter-label">
                            <span class="key">Redis Status</span>
                            <span class="val" style="color: var(--text-secondary);">Offline</span>
                        </div>
                        <div class="meter-bar">
                            <div class="meter-fill" style="width: 0%; background: var(--text-secondary);"></div>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="cache-meter-item">
                        <div class="meter-label">
                            <span class="key">ML Predictions</span>
                            <span class="val enabled" id="ml-status">Active</span>
                        </div>
                        <div class="meter-bar">
                            <div class="meter-fill" style="width: 100%; background: linear-gradient(90deg, var(--success), #00cc6a);"></div>
                        </div>
                    </div>
                    <div class="cache-meter-item">
                        <div class="meter-label">
                            <span class="key">Avg ML Confidence</span>
                            <span class="val" id="ml-conf">--</span>
                        </div>
                        <div class="meter-bar">
                            <div class="meter-fill" id="ml-conf-meter" style="width: 50%;"></div>
                        </div>
                    </div>
                    <div class="cache-meter-item">
                        <div class="meter-label">
                            <span class="key">Regime Distribution</span>
                            <span class="val" id="regime-dist">--</span>
                        </div>
                        <div class="meter-bar">
                            <div class="meter-fill" style="width: 60%; background: linear-gradient(90deg, var(--accent-pink), var(--accent-orange));"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Toast Notification Container -->
    <div id="toast-container"></div>

    <script>
        // ===== State =====
        let allResults = [];
        let currentSort = { column: null, direction: 'asc' };

        // ===== DOM =====
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const searchInput = document.getElementById('search-input');
        const signalFilter = document.getElementById('signal-filter');
        const timeframeFilter = document.getElementById('timeframe-filter');
        const regimeFilter = document.getElementById('regime-filter');
        const exportCsvBtn = document.getElementById('export-csv');
        const loadAnotherBtn = document.getElementById('load-another');
        const resultsCount = document.getElementById('results-count');

        // ===== Toast =====
        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            const icons = {
                'success': 'fa-check-circle', 'error': 'fa-exclamation-circle',
                'info': 'fa-info-circle', 'warning': 'fa-exclamation-triangle'
            };
            toast.innerHTML = `<i class="fas ${icons[type] || icons.info}"></i><span>${message}</span>`;
            container.appendChild(toast);
            setTimeout(() => toast.classList.add('show'), 10);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // ===== File Upload =====
        uploadArea.addEventListener('click', () => fileInput.click());
        uploadArea.addEventListener('dragover', (e) => { e.preventDefault(); uploadArea.classList.add('drag-over'); });
        uploadArea.addEventListener('dragleave', () => uploadArea.classList.remove('drag-over'));
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault(); uploadArea.classList.remove('drag-over');
            if (e.dataTransfer.files.length) handleFile(e.dataTransfer.files[0]);
        });
        fileInput.addEventListener('change', (e) => { if (e.target.files.length) handleFile(e.target.files[0]); });

        loadAnotherBtn.addEventListener('click', () => fileInput.click());

        function handleFile(file) {
            const reader = new FileReader();
            reader.onload = (e) => parseCSV(e.target.result, file.name);
            reader.readAsText(file);
        }

        function parseCSV(text, filename) {
            const lines = text.trim().split('\n');
            if (lines.length < 2) { showToast('CSV file appears empty', 'warning'); return; }

            const headers = lines[0].split(',');
            const signals = [];

            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',');
                if (values.length < headers.length) continue;
                const row = {};
                headers.forEach((h, idx) => row[h.trim()] = values[idx].trim());
                signals.push(row);
            }

            allResults = signals;
            showDashboard();
            populateFilters();
            filterAndDisplayResults();
            updateStats();

            showToast(`Loaded ${signals.length} signal(s) from ${filename}`, 'success');
            document.getElementById('status-text').textContent = 'Online';
        }

        function showDashboard() {
            document.getElementById('upload-section').style.display = 'none';
            document.getElementById('stats-section').style.display = 'grid';
            document.getElementById('signals-section').style.display = 'block';
            document.getElementById('config-section').style.display = 'block';
            document.getElementById('cache-section').style.display = 'block';
        }

        // ===== Filters =====
        function populateFilters() {
            // Timeframes
            const tfs = [...new Set(allResults.map(r => r.timeframe))].sort();
            timeframeFilter.innerHTML = '<option value="all">All Timeframes</option>';
            tfs.forEach(tf => {
                timeframeFilter.innerHTML += `<option value="${tf}">${tf}</option>`;
            });

            // Regimes
            const regimes = [...new Set(allResults.map(r => r.regime).filter(Boolean))].sort();
            regimeFilter.innerHTML = '<option value="all">All Regimes</option>';
            regimes.forEach(r => {
                regimeFilter.innerHTML += `<option value="${r}">${r}</option>`;
            });
        }

        searchInput.addEventListener('input', filterAndDisplayResults);
        signalFilter.addEventListener('change', filterAndDisplayResults);
        timeframeFilter.addEventListener('change', filterAndDisplayResults);
        regimeFilter.addEventListener('change', filterAndDisplayResults);

        function filterAndDisplayResults() {
            let filtered = allResults;

            const searchTerm = searchInput.value.toLowerCase();
            if (searchTerm) {
                filtered = filtered.filter(r => (r.symbol || '').toLowerCase().includes(searchTerm));
            }

            const signal = signalFilter.value;
            if (signal !== 'all') {
                filtered = filtered.filter(r => r.signal_type === signal);
            }

            const tf = timeframeFilter.value;
            if (tf !== 'all') {
                filtered = filtered.filter(r => r.timeframe === tf);
            }

            const regime = regimeFilter.value;
            if (regime !== 'all') {
                filtered = filtered.filter(r => r.regime === regime);
            }

            renderResults(filtered);
            updateResultsCount(filtered.length, allResults.length);
        }

        // ===== Stats =====
        function updateStats() {
            const total = allResults.length;
            const longs = allResults.filter(r => r.signal_type === 'LONG').length;
            const shorts = allResults.filter(r => r.signal_type === 'SHORT').length;
            const avgConf = allResults.reduce((a, r) => a + parseFloat(r.confidence || 0), 0) / (total || 1);

            animateValue('total-signals', 0, total, 800);
            animateValue('long-signals', 0, longs, 800);
            animateValue('short-signals', 0, shorts, 800);

            document.getElementById('avg-confidence').textContent = (avgConf * 100).toFixed(0) + '%';

            // Last scan
            if (total > 0) {
                const lastTs = allResults[total - 1].timestamp;
                if (lastTs) {
                    const scanDate = new Date(lastTs);
                    const now = new Date();
                    const diffMins = Math.floor((now - scanDate) / 60000);
                    let timeAgo;
                    if (diffMins < 1) timeAgo = 'Just now';
                    else if (diffMins < 60) timeAgo = `${diffMins}m ago`;
                    else if (diffMins < 1440) timeAgo = `${Math.floor(diffMins / 60)}h ago`;
                    else timeAgo = `${Math.floor(diffMins / 1440)}d ago`;
                    document.getElementById('last-scan').textContent = timeAgo;
                }
            }

            // ML stats
            document.getElementById('ml-conf').textContent = (avgConf * 100).toFixed(1) + '%';
            document.getElementById('ml-conf-meter').style.width = (avgConf * 100) + '%';

            // Regime distribution
            const regimes = {};
            allResults.forEach(r => {
                const reg = r.regime || 'unknown';
                regimes[reg] = (regimes[reg] || 0) + 1;
            });
            const topRegime = Object.entries(regimes).sort((a, b) => b[1] - a[1])[0];
            if (topRegime) {
                document.getElementById('regime-dist').textContent = `${topRegime[0]} (${topRegime[1]})`;
            }
        }

        function animateValue(id, start, end, duration) {
            const element = document.getElementById(id);
            if (!element) return;
            const range = end - start;
            if (range === 0) { element.textContent = end; return; }
            const increment = range / (duration / 16);
            let current = start;
            const timer = setInterval(() => {
                current += increment;
                if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
                    current = end;
                    clearInterval(timer);
                }
                element.textContent = Math.floor(current);
            }, 16);
        }

        // ===== Table Rendering =====
        function renderResults(results) {
            const tbody = document.querySelector('#results-table tbody');
            tbody.innerHTML = '';

            if (!results || results.length === 0) {
                tbody.innerHTML = '<tr><td colspan="11" style="text-align:center; padding: 40px; color: var(--text-secondary);">No signals match your filters.</td></tr>';
                return;
            }

            results.forEach(res => {
                const row = document.createElement('tr');
                const signalType = res.signal_type || 'N/A';
                const signalClass = signalType === 'LONG' ? 'signal-long' : 'signal-short';
                const exchange = res.exchange || 'BINANCE';

                const dailyChange = parseFloat(res.daily_change || 0);
                const dailyChangeClass = dailyChange >= 0 ? 'daily-change-positive' : 'daily-change-negative';

                const conf = parseFloat(res.confidence || 0);
                let confClass = 'conf-low';
                if (conf > 0.7) confClass = 'conf-high';
                else if (conf > 0.5) confClass = 'conf-mid';

                const price = parseFloat(res.price || 0);
                const priceStr = price >= 1 ? price.toFixed(2) : price.toFixed(6);

                const symbol = res.symbol || 'Unknown';

                row.innerHTML = `
                    <td><strong>${symbol}</strong></td>
                    <td><span class="badge-exchange">${exchange}</span></td>
                    <td><span class="badge-tf">${res.timeframe || 'N/A'}</span></td>
                    <td class="${signalClass}">${signalType}</td>
                    <td>${parseFloat(res.angle || 0).toFixed(2)}Â°</td>
                    <td style="font-family: 'Courier New', monospace;">$${priceStr}</td>
                    <td class="${dailyChangeClass}">${dailyChange >= 0 ? '+' : ''}${dailyChange.toFixed(2)}%</td>
                    <td class="confidence-cell">
                        <div class="confidence-bar-wrap">
                            <div class="confidence-bar"><div class="confidence-fill ${confClass}" style="width:${conf * 100}%"></div></div>
                            <span class="confidence-text">${(conf * 100).toFixed(0)}%</span>
                        </div>
                    </td>
                    <td><span class="badge-regime">${res.regime || '--'}</span></td>
                    <td style="font-size: 0.8rem; color: var(--text-secondary)">${res.timestamp || 'N/A'}</td>
                    <td>
                        <button class="tradingview-btn" onclick="openTradingView('${symbol}', '${res.timeframe}', '${exchange}')">
                            <i class="fas fa-chart-bar"></i> Chart
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateResultsCount(filtered, total) {
            if (filtered === total) {
                resultsCount.textContent = `Showing ${total} result${total !== 1 ? 's' : ''}`;
            } else {
                resultsCount.textContent = `Showing ${filtered} of ${total} result${total !== 1 ? 's' : ''}`;
            }
        }

        // ===== TradingView =====
        function openTradingView(symbol, timeframe, exchange) {
            let cleanSymbol = symbol.replace(/USDT|usdt/gi, '').replace(/[/:]/g, '').trim();

            const tvExchanges = {
                'BINANCE': 'BINANCE', 'MEXC': 'MEXC',
                'binance': 'BINANCE', 'mexc': 'MEXC'
            };
            const tvExchange = tvExchanges[exchange] || 'BINANCE';
            const tvSymbol = `${cleanSymbol}USDT`;

            const tvTimeframes = {
                '15m': '15', '30m': '30', '45m': '45',
                '1h': '60', '2h': '120', '4h': '240',
                '12h': '720', '1d': 'D', '2d': '2D', '1w': 'W', '1M': 'M'
            };
            const tvTF = tvTimeframes[timeframe] || '60';

            const url = `https://www.tradingview.com/chart/?symbol=${tvExchange}:${tvSymbol}&interval=${tvTF}`;
            window.open(url, '_blank');
            showToast(`Opening ${cleanSymbol} on TradingView`, 'info');
        }

        // ===== Sorting =====
        document.querySelectorAll('.sortable').forEach(header => {
            header.addEventListener('click', () => sortResults(header.dataset.sort));
        });

        function sortResults(column) {
            if (currentSort.column === column) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.column = column;
                currentSort.direction = 'asc';
            }
            updateSortIcons();
            applySortToResults();
            filterAndDisplayResults();
        }

        function updateSortIcons() {
            document.querySelectorAll('.sort-icon').forEach(icon => {
                icon.className = 'fas fa-sort sort-icon';
            });
            if (currentSort.column) {
                const header = document.querySelector(`[data-sort="${currentSort.column}"]`);
                if (header) {
                    const icon = header.querySelector('.sort-icon');
                    icon.className = `fas fa-sort-${currentSort.direction === 'asc' ? 'up' : 'down'} sort-icon active`;
                }
            }
        }

        function applySortToResults() {
            if (!currentSort.column) return;
            allResults.sort((a, b) => {
                let aVal, bVal;
                switch (currentSort.column) {
                    case 'symbol': aVal = a.symbol || ''; bVal = b.symbol || ''; break;
                    case 'exchange': aVal = a.exchange || ''; bVal = b.exchange || ''; break;
                    case 'timeframe': aVal = a.timeframe || ''; bVal = b.timeframe || ''; break;
                    case 'signal': aVal = a.signal_type || ''; bVal = b.signal_type || ''; break;
                    case 'angle': aVal = parseFloat(a.angle) || 0; bVal = parseFloat(b.angle) || 0; break;
                    case 'price': aVal = parseFloat(a.price) || 0; bVal = parseFloat(b.price) || 0; break;
                    case 'change': aVal = parseFloat(a.daily_change) || 0; bVal = parseFloat(b.daily_change) || 0; break;
                    case 'confidence': aVal = parseFloat(a.confidence) || 0; bVal = parseFloat(b.confidence) || 0; break;
                    case 'timestamp': aVal = new Date(a.timestamp || 0); bVal = new Date(b.timestamp || 0); break;
                    default: return 0;
                }
                if (aVal < bVal) return currentSort.direction === 'asc' ? -1 : 1;
                if (aVal > bVal) return currentSort.direction === 'asc' ? 1 : -1;
                return 0;
            });
        }

        // ===== Export =====
        exportCsvBtn.addEventListener('click', () => {
            if (allResults.length === 0) { showToast('No results to export', 'warning'); return; }

            const headers = ['symbol', 'exchange', 'timeframe', 'signal_type', 'angle', 'price', 'daily_change', 'confidence', 'volume', 'regime', 'timestamp'];
            const csv = [
                headers.join(','),
                ...allResults.map(r => headers.map(h => r[h] || '').join(','))
            ].join('\n');

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ama_pro_results_${new Date().toISOString().slice(0, 10)}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
            showToast('Results exported successfully', 'success');
        });

        // ===== Sidebar Navigation =====
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                const section = item.dataset.section;
                document.getElementById(section)?.scrollIntoView({ behavior: 'smooth' });

                document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                item.classList.add('active');
            });
        });
    </script>
</body>

</html>
